package com.yonseidairy.site.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.yonseidairy.site.dao.RegionDao;
import com.yonseidairy.site.mapper.HomeMapper;

@Service
public class HomeService {

	@Autowired
	private HomeMapper homeMapper;
	private final ObjectMapper objectMapper;
	
	public List<RegionDao> selectAllRegions() {
		List<RegionDao> result = new ArrayList<>();
		List<RegionDao> rawList = homeMapper.selectAllRegions();
		
		for (RegionDao r : rawList) {
            try {
                String json = r.getPolygon_coords(); // CLOB → String으로 매핑된 필드
                if (json != null && !json.trim().isEmpty()) {
                    List<double[]> polygon = objectMapper.readValue(json, new TypeReference<List<double[]>>() {});
                    r.setPolygon(polygon);
                }
            } catch (Exception e) {
                e.printStackTrace(); // 예외 로깅 처리
            }
            result.add(r);
        }
		
		return homeMapper.selectAllRegions();
	};
	
}
