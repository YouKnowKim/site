package com.yonseidairy.site.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.google.gson.JsonArray;
import com.google.gson.JsonElement;
import com.google.gson.JsonParser;
import com.yonseidairy.site.dao.RegionDao;
import com.yonseidairy.site.mapper.RegionMapper;

@Service
public class RegionService {

	@Autowired
	private RegionMapper regionMapper;
	
	public List<RegionDao> selectAllRegions(RegionDao inRegionDao) {
		List<RegionDao> result = new ArrayList<>();
		List<RegionDao> rawList = regionMapper.selectAllRegions(inRegionDao);
		
		for (RegionDao raw : rawList) {
            raw.setPolygon(parsePolygon(raw.getPolygon_coords()));
            
            result.add(raw);
        }
		
		return result;
	};
	
	private List<double[]> parsePolygon(String json) {
        List<double[]> list = new ArrayList<>();
        JsonArray array = JsonParser.parseString(json).getAsJsonArray();

        for (JsonElement elem : array) {
            JsonArray pair = elem.getAsJsonArray();
            double lat = pair.get(0).getAsDouble();
            double lng = pair.get(1).getAsDouble();
            list.add(new double[]{lat, lng});
        }

        return list;
    }

	public List<RegionDao> selectRegions(RegionDao inRegionDao) {
		// TODO Auto-generated method stub
		return null;
	}
	
}
